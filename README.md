# gdmn-webservice

# Web-interface

Для управления пользователями определенной компании необходимо создать учетную запись для администратора. **Администратор** – пользователь, у которого есть полный доступ ко всем данным. Он может создавать компании и выполнять все действия с пользователями и устройствами данной компании.

## 1. Регистрация пользователя

![alt text](img/Web/1.Register/1.Start.png)

При первом подключении необходимо пройти регистрацию. Для этого необходимо нажать на **Зарегистрироваться**.

По нажатию переходим на страницу регистрации.

![alt text](img/Web/1.Register/1.SignUp.png)

Для регистрации необходимо заполнить поля **Учетная запись** и **Пароль**, **Повторите Пароль** и нажать на кнопку **Зарегистрироваться**.

![alt text](img/Web/1.Register/1.SignUpAdmin.png)

## 2. Вход в учетную запись

Для входа в систему администрирования вводим имя пользователя и пароль администратора.

![alt text](img/Web/2.Login/2.SignInAdmin.png)

После нажатия на кнопку **Войти** попадаем на главную страницу. Данное окно является главным до создания организации. Затем главной страницей становится страница со списком организаций.

![alt text](img/Web/2.Login/2.Main.png)

Здесь представлена информации об администраторе системы.

В верхнем правом углу панель навигации. По нажатию на иконку **+** открывается меню, позволяющее создавать организации, добавлять пользователей и устройства.

![alt text](img/Web/2.Login/2.Adds.png)

По нажатию на вторую иконку открывается меню администратора. 

![alt text](img/Web/2.Login/2.AdmMenu.png)

 По нажатию на **Редактировать профиль** можно перейти в окно просмотра и редактирования информации по администратору. В нем также отображаются организации и устройства. По нажатию на **Мои организации** можно перейти в окно просмотра существующих организаций. Кнопка **Выйти** осуществляет выход из учетной записи администратора.

 ## 3. Организации

 В первую очередь администратору необходимо создать организацию, в которую будут входить пользователи мобильных устройств. Нажмем на иконку **+** и выберем пункт **Создать организацию**. 

![alt text](img/Web/3.Company/3.Company.png)

Заполним поле и нажмем сохранить.

![alt text](img/Web/3.Company/3.Companies.png)

Созданная организация отображается в **Мои организации**. 

При наличии минимум одной организации данное окно является главным.

По нажатию на название организации переходим в окно просмотра и редактирования информации. 

![alt text](img/Web/3.Company/3.CompanyUser.png)


## 4. Пользователи

Администратору необходимо создать пользователя, к которому будет привязано мобильное устройство. Число пользователей не ограничено.

Добавление пользователей и устройств возможно двумя способами. Второй способ будет рассмотрен в пункте **Гедымин**.

По нажатию на иконку **+** выбираем **Создать пользователя**.

![alt text](img/Web/4.User/4.CompanyMenu.png)

![alt text](img/Web/4.User/4.User.png)

Добавим пользователя.

![alt text](img/Web/4.User/4.UserAdd.png)

Новый пользователь отобразился в таблице.

![alt text](img/Web/4.User/4.CompanyUsers.png)

По нажатию на строку, содержащую название пользователя, пользователь выделяется и появляется возможность его удалить.

![alt text](img/Web/4.User/4.UserDelete.png)

По нажатию на имя пользователя перейдем в окно просмотра и редактирования информации по пользователю.

![alt text](img/Web/4.User/4.UserProfile.png)

 ## 5. Устройства.

Администратору необходимо создать мобильное устройство, которое далее будет привязано к пользователю. Число устройств не ограничено.

По нажатию на иконку **+** выбираем **Добавить устройство**.

![alt text](img/Web/5.Device/5.UserMenu.png)

![alt text](img/Web/5.Device/5.Device.png)

Добавим устройство.

![alt text](img/Web/5.Device/5.DeviceEdit.png)

Новое устройство отобразилось в таблице.

![alt text](img/Web/4.User/4.UserCompanyDevice.png)


У устройства может быть один из четырех статусов.

| Статус              | Описание                                                                      |
| ------------------- | ----------------------------------------------------------------------------- |
| NEW | Устройство получает данный статус при создании                                |
| NON-ACTIVATED         | Устройство получает данный статус после создания кода активации               |
| ACTIVE             | Устройство получает данный статус после активации кода в мобильном приложении |
| BLOCKED      | Администратор использует данный статус для блокировки устройства              |

По нажатию на наименование устройства открывается меню. 

![alt text](img/Web/5.Device/5.DeviceMenu.png)

**Получить код** обеспечивает получение кода активации. По нажатию на данную кнопку открывается всплывающее окно с кодом. 

![alt text](img/Web/5.Device/5.Code.png)

**Заблокировать** меняет статус устройства на BLOCKED и делает его недоступным для пользователя. Вернуть доступ к устройству и статус ACTIVE можно с помощью кнопки **Разблокировать**. Также можно удалить устройство. 


# Гедымин

В исследователе подсистема Мобильное приложение состоит из следующих пунктов:

![alt text](img/Gedemin/Menu.png)

01. Конфигурация содержит параметры подключения и логины пароли служебных пользователей, а также кнопки для проверки корректности внесенных данных.

![alt text](img/Gedemin/Configuration.png)

URL содержит полный URL компьютера, где запущен сервер приложения.

Кнопка **Проверить** позволяет проверить наличие соединения с сервером. При правильной отработке получаем сообщение **Подключение к серверу прошло успешно!**.

![alt text](img/Gedemin/Ok.png)

Кнопка **Получить код** заполняет код компании по названию из системы администрирования. 
**Важно! Не изменяйте имена и пароли служебных пользователей и версии API!**

02. Отправить справочники
по нажатию этой кнопки на сервер отправляется файл с данными в справочниках, необходимых для работы приложения. Пункт используется при срочной необходимости обновить все справочники у всех пользователей либо для отладки. При подключенной автозадаче обработки ручная отправка справочников не требуется.

03. Обработать запросы
по нажатию этой кнопки обрабатываются запросы с мобильного приложения. При подключенной автозадаче обработки ручная обработка запросов по кнопке не требуется.

04. Отправить справочники MOCK
по нажатию этой кнопки отправляется файл с данными в справочниках, необходимых для работы приложения без включенного сервера. Пункт используется только для отладки.

**Пользователи мобильного приложения**

Содержит список пользователей с настройками.
**Важно! Не удаляйте и не редактируйте служебных пользователей gdmn и system!**

Если пользователи не настроены или в системе администрирования добавились новые, их надо импортировать из системы администрирования макросом GDMN. Получить пользователей из WEB_ADMIN в форме просмотра Пользователи мобильного приложения.

Также можно создать пользователя вручную. 

![alt text](img/Gedemin/Add.png)

![alt text](img/Gedemin/Choice.png)

![alt text](img/Gedemin/AddUser.png)

![alt text](img/Gedemin/AddNewUser.png)

![alt text](img/Gedemin/User.png)

После добавления нового пользователя необходимо создать пользователя для автозадачи и экспортировать пользователя на сервер. Для этого нажимаем на иконку ϟ и выберем пункты **GDMN_0.0.0. Создать пользователя для автозадачи** и **GDMN_0.0.0. Экспорт пользователей на сервер (справочник)**.

![alt text](img/Gedemin/Macros.png)

После этого автоматически создается устройство пользователя. 

![alt text](img/Gedemin/UserDevice.png)

# Mobile

## 1. Подключение

После выполнения установки приложения необходимо на рабочем столе кликнуть по иконке:

![alt text](img/Mobile/1.Connection/1.Icon.png)

<img src="img/Mobile/1.Connection/1.Connection.jpg" alt="drawing" height="600"/>

В правом нижнем углу находится иконка, по нажатию на которую можно перейти на экран **Настройка подключения**. Если поля **Адрес сервера**, **Порт** или **Время ожидания** являются пустыми, их необходимо заполнить.

<img src="img/Mobile/1.Connection/1.Server.jpg" alt="drawing" height="600"/>

Вернемся в предыдущий экран и нажмем кнопку **Подключиться**.

Если подключение прошло успешно, то появляется экран **Активация устройства**, предназначенный для ввода кода активации (при повторном запуске в будет происходить автоматический вход в учетную запись пользователя). Здесь нужно ввести код, ранее полученный в web-admin, и нажать **Отправить**. По нажатию на иконку в правом нижнем углу можно перейти в предыдущий экран.

<img src="img/Mobile/1.Connection/1.ActivationCode.jpg" alt="drawing" height="600"/> <img src="img/Mobile/1.Connection/1.Code.jpg" alt="drawing" height="600"/>

Если активация устройства прошла успешно, появляется экран для входа пользователя. В соответствующие поля необходимо ввести **Имя пользователя** и **Пароль** и нажать на кнопку **Войти**. По нажатию на иконку в правом нижнем углу можно перейти в предыдущий экран.

<img src="img/Mobile/1.Connection/1.Login.jpg" alt="drawing" height="600"/> <img src="img/Mobile/1.Connection/1.LoginUser.jpg" alt="drawing" height="600"/>

Если вход в учетную запись прошел успешно, появляется экран выбора нужной организации. Необходимо выбрать нужную организацию и нажать на кнопку **Войти**.

<img src="img/Mobile/1.Connection/1.CompanyChoice.jpg" alt="drawing" height="600"/> <img src="img/Mobile/1.Connection/1.Company.jpg" alt="drawing" height="600"/>

При успешном выполнении входа попадаем на главный экран -- **Документы**. Панель навигации, расположенная в нижней части экрана, позволяет переключаться между экранами **Документы**, **Справочники** и **Настройки**.

Так как это первый вход, данные не загружены. Необходимо загрузить данные - справочники. Для этого необходимо перейти на экран **Справочники**, нажать на иконку отправления запроса на сервер **🗘**, находящуюся в нижнем правом углу.

<img src="img/Mobile/1.Connection/1.References.jpg" alt="drawing" height="600"/> <img src="img/Mobile/1.Connection/1.ReferencesRequest.jpg" alt="drawing" height="600"/>

Затем необходимо перейти на окно **Настройки** и нажать на кнопку **Проверить обновления**, находящуюся в нижней части экрана. 

<img src="img/Mobile/1.Connection/1.Settings.jpg" alt="drawing" height="600"/> <img src="img/Mobile/1.Connection/1.RequestOk.jpg" alt="drawing" height="600"/>

Если загрузка проводится не первый раз и обновлений в справочниках нет, то будет выведено соответствующее соообщение.

<img src="img/Mobile/1.Connection/1.RequestNot.jpg" alt="drawing" height="600"/>

Если есть документы со статусами **Черновик** или **Готово**, справочники обновить нельзя.

<img src="img/Mobile/1.Connection/1.Error.jpg" alt="drawing" height="600"/>

После загрузки данных в разделе **Справочники** отобразятся все актуальные справочники.


## 2. Справочники

Для начала рассмотрим экран **Справочники**, чтобы посмотреть имеющиеся данные. Для этого перейдем в соответствующий пункт панели навигации.

Экран **Справочники** содержит информацию о справочниках устройства.

<img src="img/Mobile/2.References/2.References.jpg" alt="drawing" height="600"/>

При нажатии на конкретный справочник переходим на экран просмотра.

<img src="img/Mobile/2.References/2.Goods.jpg" alt="drawing" height="600"/>

По нажатию на товар можно перейти в окно просмотра позиций.

<img src="img/Mobile/2.References/2.GoodPosition.jpg" alt="drawing" height="600"/>

Рассмотрим еще один справочник.

<img src="img/Mobile/2.References/2.Goodgroups.jpg" alt="drawing" height="600"/>

## 3. Документы

Перейдем на экран **Документы**.

<img src="img/Mobile/3.Documents/3.Documents.jpg" alt="drawing" height="600"/>

По нажатию на иконку **+** в правом нижнем углу переходим в окно добавления документа. 

Каждое поле является обязательным для заполнения.

<img src="img/Mobile/3.Documents/3.Add.jpg" alt="drawing" height="600"/> <img src="img/Mobile/3.Documents/3.AddType.jpg" alt="drawing" height="600"/> <img src="img/Mobile/3.Documents/3.AddDepartment.jpg" alt="drawing" height="600"/>

Для добавления заявки необходимо нажать на **ГОТОВО** в правом верхнем углу.

<img src="img/Mobile/3.Documents/3.AddNew.jpg" alt="drawing" height="600"/>


После добавления сразу попадаем в экран просмотра документа. 

<img src="img/Mobile/3.Documents/3.DocumentView.jpg" alt="drawing" height="600"/>

У каждого документа есть свой цвет иконки или полосы, который отображает состояние заявки. При смене состояния заявки меняется и цвет.

| Цвет    | Описание состояния                         |
| ------- | ------------------------------------------ |
| Голубой | Документ в статусе черновика |
| Желтый | Документ обрабатывается|
| Зеленый | Документ отправлен |

По нажатию на иконку, расположенную в правом верхнем углу, можно перейти на экран редактирования документа. Доступно редактирование информации, удаление документа, а также изменение статуса документа.

Вернемся на экран просмотра документа.

Добавление позиций в документ возможно двумя способами: с помощью поиска по списку товаров или считыванием штрихкода сканером.

По нажатию на иконку, расположенную в левом нижнем углу, переходим на экран считывания штрихкода. Для открытия сканера необходимо дать разрешение приложению для доступа к камере.

<img src="img/Mobile/3.Documents/3.Permission.jpg" alt="drawing" height="250"/>

После открытия сканера необходимо навести рамку на штрихкод, и он будет автоматически считан. Для добавления товара необходимо нажать на кнопку с информацией по товару. Для нового сканирования нужно нажать на кнопку **Пересканировать**. В случае отсутствия товара в справочнике будет выведена запись **Товар не найден**.

<img src="img/Mobile/3.Documents/3.Scan.jpg" alt="drawing" height="600"/> <img src="img/Mobile/3.Documents/3.ScanNotFound.jpg" alt="drawing" height="600"/> <img src="img/Mobile/3.Documents/3.ScanOk.jpg" alt="drawing" height="600"/>

После добавления товара происходит переход на экран с позициями товара.

<img src="img/Mobile/3.Documents/3.GoodPositionScan.jpg" alt="drawing" height="600"/>

Для изменения доступны два поля - количество и EID. 

Для заполнения **EID** необходимо нажать на кнопку **Сканировать EID**. 
После открытия сканера необходимо навести рамку на datamatrix, и он будет автоматически считан. Для добавления EID необходимо нажать на кнопку, содержащую информацию из datamatrix. Для нового сканирования нужно нажать на кнопку **Пересканировать**. 

<img src="img/Mobile/3.Documents/3.EIDScan.jpg" alt="drawing" height="600"/><img src="img/Mobile/3.Documents/3.EidOk.jpg" alt="drawing" height="600"/>

По нажатию на кнопку **ГОТОВО** товар добавляется в позиции документа.

<img src="img/Mobile/3.Documents/3.GoodPositionEid.jpg" alt="drawing" height="600"/> <img src="img/Mobile/3.Documents/3.DocumentDraftOne.jpg" alt="drawing" height="600"/>

Теперь добавим товар вторым способом. По нажатию на иконку в правом нижнем углу экрана переходим на экран поиска товаров. 

<img src="img/Mobile/3.Documents/3.Remains.jpg" alt="drawing" height="600"/>

Ищем нужный товар, нажимаем на него и переходим на экран с позициями товара. Заполняем нужные поля и добавляем товар.

<img src="img/Mobile/3.Documents/3.GoodPosition.jpg" alt="drawing" height="600"/> <img src="img/Mobile/3.Documents/3.DocumentDraft.jpg" alt="drawing" height="600"/>

Для отправки документа на сервер необходимо сменить статус документа. Заходим в экран редактирования документа и меняем статус.

<img src="img/Mobile/3.Documents/3.EditDraft.jpg" alt="drawing" height="600"/> <img src="img/Mobile/3.Documents/3.EditReady.jpg" alt="drawing" height="600"/> <img src="img/Mobile/3.Documents/3.DocumentReady.jpg" alt="drawing" height="600"/>

Вернемся на главный экран документов.

<img src="img/Mobile/3.Documents/3.DocumentsReady.jpg" alt="drawing" height="600"/>

Рассмотрим подробнее данный экран. 

По нажатию на иконке в правой части строки моиска можно настроить фильтр поиска.

<img src="img/Mobile/3.Documents/3.SearchFilters.jpg" alt="drawing" height="600"/>

Если смахнуть документ влево, то появится меню в дополнительными иконками. 

<img src="img/Mobile/3.Documents/3.Swipe.jpg" alt="drawing" height="600"/>

Данное меню позволяет редактировать документ (если он является доступным для редактирования) и удалить.

По нажатию на иконку в правом верхнем углу открывается меню. В нем представлены следующие пункты: **Создать документ**, **Выгрузить документы**, **Удалить документы**.

<img src="img/Mobile/3.Documents/3.DocumentsMenu.jpg" alt="drawing" height="600"/>

После нажатия на **Выгрузить документы** все документы, имеющие статус **Готово**, отправляются на сервер, и их статус меняется на **Отправлено**.

<img src="img/Mobile/3.Documents/3.DocsOk.jpg" alt="drawing" height="600"/><img src="img/Mobile/3.Documents/3.DocumentSent.jpg" alt="drawing" height="600"/>

## 4. Настройки

Экран **Настройки** содержит информацию о настройках устройства и информацию о пользователе. 

В верхей части экрана отображена информация о пользователе устройства и его организации. По нажатию на иконку **⋮** открывается меню, позволяющее сменить пользователя / организацию, а также удалить все данные.

Настройки организции доступны для изменения пользователем. По умолчанию в Настройках организации есть следующие поля: **Использовать сканер штрихкодов** и **Удалять документы после обработки учетной системой**. 

<img src="img/Mobile/4.Settings/4.Settings.jpg" alt="drawing" height="600"/> <img src="img/Mobile/4.Settings/4.SettingsMenu.jpg" alt="drawing" height="600"/>

При использовании приложения на терминале сбора данных необходимо сделать активным поле **Использовать сканер штрихкодов**.

<img src="img/Mobile/4.Settings/4.SettingsScanner.jpg" alt="drawing" height="600"/>